import{c as ae,_ as V,p as Y,d as X,u as P,$ as M,e as ce,w as dt,a as nt,f as lt,n as ot,g as rt,r as W,o as mt,h as ft,b as Be}from"./index-75c887b9.js";const wt=window.Vue.toDisplayString,G=window.Vue.normalizeStyle,z=window.Vue.openBlock,q=window.Vue.createElementBlock,Ee=window.Vue.createCommentVNode,ze=window.Vue.unref,Fe=window.Vue.renderList,je=window.Vue.Fragment,fe=window.Vue.resolveComponent,He=window.Vue.createBlock,_t=window.Vue.createTextVNode,Te=window.Vue.withCtx,qe=window.Vue.createVNode,ie=window.Vue.createElementVNode,we=window.Vue.withModifiers,ht={class:"_w_100p _ph_10"},gt={class:"_fx_rc"},vt=ie("div",{class:"_s_1_20_white"},null,-1),bt=ie("div",{class:"_s_1_20_white _ml_2"},null,-1),$t=[vt,bt],yt={__name:"Col",props:{panelData:null,parent:null,col:null,cols:null,index:null,startDragH:null,startDragV:null,showContextMenu:null,onSelectCell:null},setup(t){const g=t,m=ae({resizerVisile:!1}),D=l=>{const{offsetX:e}=l;e>g.col.w*4/5&&e<=g.col.w&&g.index<g.cols.length-1&&(m.resizerVisile=!0)},b=()=>{m.resizerVisile=!1},_=l=>l.replace(/\$\{([^}]+)\}/g,(e,f)=>V.get(g.panelData,f,"[错误变量]")),o=async l=>{let e=m.formData,{formatParams:f,formatResult:d}=l.formOptions;if(f=Y(f),d=Y(d),f&&(e=f({$:e,_:V,moment:X,utils:P})),e&&!V.isPlainObject(e))return M("参数必须是对象");console.log("表单发送的数据：",e);const $=await ce(l.formOptions.api.replace(/^\/?(api)?\/?/,"/"),e);if(!$.success)return M($.message);console.log("表单收到的数据：",$.result),d({$:$.result,_:V,moment:X,utils:P})};return(l,e)=>{var x;const f=fe("FormItem"),d=fe("el-button"),$=fe("el-form");return z(),q("div",{style:G(l._u(`_fx_c _por _s_${t.col.w}_${t.col.h}`,t.col.bc&&`_bc_${t.col.bc}`,t.col.selected&&" _bo_1_dashed",t.col.image&&`_bi_${t.col.image}_${t.col.objectFit||"full"}`)),onMousemove:D,onMouseleave:e[2]||(e[2]=h=>b()),onContextmenu:e[3]||(e[3]=we(h=>t.showContextMenu(h,{parent:t.parent,col:t.col,cols:t.cols,index:t.index}),["prevent","stop"])),onClick:e[4]||(e[4]=we(h=>t.onSelectCell(h,{parent:t.parent,col:t.col,cols:t.cols,index:t.index}),["prevent","stop"]))},[t.col.text?(z(),q("div",{key:0,style:G(l._u(`_s_${t.col.w}_${t.col.h} _poa_t0_l0`,t.col.color&&`_c_${t.col.color}`,(t.col.justifyContent||t.col.alignItems)&&`_fx_r_j${t.col.justifyContent||0}_a${t.col.alignItems||0}`,t.col.fontSize&&`_fs_${t.col.fontSize}`,t.col.fontWeight&&`_fw_${t.col.fontWeight}`,t.col.lineHeight&&`_lh_${t.col.lineHeight}`,t.col.letterSpacing&&`_ls_${t.col.letterSpacing}`,t.col.textIndent&&`_ti_${t.col.textIndent}em`,t.col.textAlign&&`_ta_${t.col.textAlign}`,l.$_.includes(t.col.textDecoration,"italic")&&"_italic",l.$_.without(t.col.textDecoration,"italic").length&&`_td_${l.$_.without(t.col.textDecoration,"italic").join("_")}`,{"white-space":"pre-wrap"}))},wt(_(t.col.text)),5)):t.col.forms?(z(),q("div",{key:1,style:G(l._u(`_s_${t.col.w}_${t.col.h} _poa_t0_l0`,(t.col.justifyContent||t.col.alignItems)&&`_fx_r_j${t.col.justifyContent||"c"}_a${t.col.alignItems||"c"}`))},[ie("div",ht,[qe($,{"label-width":((x=l.row.formOptions)==null?void 0:x.labelWidth)||40,model:ze(m).formData},{default:Te(()=>[(z(!0),q(je,null,Fe(t.col.forms,(h,S)=>(z(),He(f,{key:S,label:h.form.label,prop:h.form.name,value:{type:h.form.type,required:!1,...h.props||{}},field:{remark:h.props.remark},form:{}},null,8,["label","prop","value","field"]))),128)),ie("div",gt,[qe(d,{plain:"",type:"primary",onClick:e[0]||(e[0]=h=>o(t.col))},{default:Te(()=>[_t("确定")]),_:1})])]),_:1},8,["label-width","model"])])],4)):Ee("",!0),(z(!0),q(je,null,Fe(t.col.rows,(h,S)=>(z(),He(Ve,{key:S,panelData:t.panelData,parent:t.col,row:h,rows:t.col.rows,index:S,startDragH:t.startDragH,startDragV:t.startDragV,showContextMenu:t.showContextMenu,onSelectCell:t.onSelectCell},null,8,["panelData","parent","row","rows","index","startDragH","startDragV","showContextMenu","onSelectCell"]))),128)),ze(m).resizerVisile?(z(),q("div",{key:2,style:G(l._u(`_poa_r0_b0 _s_10_${t.col.h} _bc_black30 _cursor_col-resize _fx_rc`)),onMousedown:e[1]||(e[1]=we(h=>t.startDragH(h,{parent:t.parent,col:t.col,cols:t.cols,index:t.index}),["prevent","stop"]))},$t,36)):Ee("",!0)],36)}}},Vt=window.Vue.toDisplayString,Q=window.Vue.normalizeStyle,F=window.Vue.openBlock,O=window.Vue.createElementBlock,Oe=window.Vue.createCommentVNode,_e=window.Vue.unref,Re=window.Vue.renderList,Le=window.Vue.Fragment,he=window.Vue.resolveComponent,Ye=window.Vue.createBlock,Ct=window.Vue.createTextVNode,Xe=window.Vue.withCtx,Pe=window.Vue.createVNode,se=window.Vue.createElementVNode,ge=window.Vue.withModifiers,xt={class:"_w_100p _ph_10"},pt={class:"_fx_rc"},kt=se("div",{class:"_s_20_1_white"},null,-1),Dt=se("div",{class:"_s_20_1_white _mt_2"},null,-1),St=[kt,Dt],Ve={__name:"Row",props:{panelData:null,parent:null,row:null,rows:null,index:null,startDragH:null,startDragV:null,showContextMenu:null,onSelectCell:null},setup(t){const g=t,m=ae({resizerVisile:!1,formData:{}}),D=l=>{const{offsetY:e}=l;e>g.row.h*4/5&&e<=g.row.h&&(m.resizerVisile=!0)},b=()=>{m.resizerVisile=!1},_=l=>l.replace(/\$\{([^}]+)\}/g,(e,f)=>V.get(g.panelData,f,"[错误变量]")),o=async l=>{let e=m.formData,{formatParams:f,formatResult:d}=l.formOptions;if(f=Y(f),d=Y(d),f&&(e=f({$:e,_:V,moment:X,utils:P})),e&&!V.isPlainObject(e))return M("参数必须是对象");console.log("表单发送的数据：",e);const $=await ce(l.formOptions.api.replace(/^\/?(api)?\/?/,"/"),e);if(!$.success)return M($.message);console.log("表单收到的数据：",$.result),d({$:$.result,data:g.panelData,_:V,moment:X,utils:P})};return(l,e)=>{var x;const f=he("FormItem"),d=he("el-button"),$=he("el-form");return F(),O("div",{style:Q(l._u(`_fx_r _por _s_${t.row.w}_${t.row.h}`,t.row.bc&&`_bc_${t.row.bc}`,t.row.selected&&" _bo_1_dashed",t.row.image&&`_bi_${t.row.image}_${t.row.objectFit||"full"}`)),onMousemove:D,onMouseleave:e[2]||(e[2]=h=>b()),onContextmenu:e[3]||(e[3]=ge(h=>t.showContextMenu(h,{parent:t.parent,row:t.row,rows:t.rows,index:t.index}),["prevent","stop"])),onClick:e[4]||(e[4]=ge(h=>t.onSelectCell(h,{parent:t.parent,row:t.row,rows:t.rows,index:t.index}),["prevent","stop"]))},[t.row.text?(F(),O("div",{key:0,style:Q(l._u(`_s_${t.row.w}_${t.row.h} _poa_t0_l0`,t.row.color&&`_c_${t.row.color}`,(t.row.justifyContent||t.row.alignItems)&&`_fx_r_j${t.row.justifyContent||0}_a${t.row.alignItems||0}`,t.row.fontSize&&`_fs_${t.row.fontSize}`,t.row.fontWeight&&`_fw_${t.row.fontWeight}`,t.row.lineHeight&&`_lh_${t.row.lineHeight}`,t.row.letterSpacing&&`_ls_${t.row.letterSpacing}`,t.row.textIndent&&`_ti_${t.row.textIndent}em`,t.row.textAlign&&`_ta_${t.row.textAlign}`,l.$_.includes(t.row.textDecoration,"italic")&&"_italic",l.$_.without(t.row.textDecoration,"italic").length&&`_td_${l.$_.without(t.row.textDecoration,"italic").join("_")}`,{"white-space":"pre-wrap"}))},Vt(_(t.row.text)),5)):t.row.forms?(F(),O("div",{key:1,style:Q(l._u(`_s_${t.row.w}_${t.row.h} _poa_t0_l0`,(t.row.justifyContent||t.row.alignItems)&&`_fx_r_j${t.row.justifyContent||"c"}_a${t.row.alignItems||"c"}`))},[se("div",xt,[Pe($,{"label-width":((x=t.row.formOptions)==null?void 0:x.labelWidth)||40,model:_e(m).formData},{default:Xe(()=>[(F(!0),O(Le,null,Re(t.row.forms,(h,S)=>(F(),Ye(f,{key:S,label:h.form.label,prop:h.form.name,value:{type:h.form.type,required:!1,...h.props||{}},field:{remark:h.props.remark},form:_e(m).formData},null,8,["label","prop","value","field","form"]))),128)),se("div",pt,[Pe(d,{plain:"",type:"primary",onClick:e[0]||(e[0]=h=>o(t.row))},{default:Xe(()=>[Ct("确定")]),_:1})])]),_:1},8,["label-width","model"])])],4)):Oe("",!0),(F(!0),O(Le,null,Re(t.row.cols,(h,S)=>(F(),Ye(yt,{key:S,panelData:t.panelData,parent:t.row,col:h,cols:t.row.cols,index:S,startDragH:t.startDragH,startDragV:t.startDragV,showContextMenu:t.showContextMenu,onSelectCell:t.onSelectCell},null,8,["panelData","parent","col","cols","index","startDragH","startDragV","showContextMenu","onSelectCell"]))),128)),_e(m).resizerVisile?(F(),O("div",{key:2,style:Q(l._u(`_poa_l0_b0 _s_${t.row.w}_10 _bc_white80 _cursor_row-resize _fx_ccc`)),onMousedown:e[1]||(e[1]=ge(h=>t.startDragV(h,{parent:t.parent,rows:t.rows,row:t.row,index:t.index}),["prevent","stop"]))},St,36)):Oe("",!0)],36)}}},ee=window.Vue.unref,It=window.Vue.renderList,Mt=window.Vue.Fragment,te=window.Vue.openBlock,We=window.Vue.createElementBlock,Ae=window.Vue.resolveComponent,Ke=window.Vue.createBlock,Nt=window.Vue.withCtx,Bt=window.Vue.createCommentVNode,Et=window.Vue.withModifiers,zt=window.Vue.resolveComponent,Ft=window.Vue.createVNode,jt={__name:"AttributePanel",props:{current:null},setup(t){const g=t,m=ae({formVisible:!1,form:{}}),D=o=>{const l=o.cell;return[{label:"宽度",name:"width",value:{type:"number",required:!1,min:20,max:375,onChange:e=>{const{index:f,cols:d}=o,$=d[f].w-e,x=f?d[f-1]:d[f+1];x.w+$>=20?(l.w=e,x.w=x.w+$):(m.form.width=l.w,_())}},visible:e=>!!e.col},{label:"高度",name:"height",value:{type:"number",required:!1,min:20,max:1e3,onChange:e=>{if(!o.parent)l.h=e;else{const{index:f,rows:d}=o,$=d[f].h-e,x=f?d[f-1]:d[f+1];x.h+$>=20?(l.h=e,x.h=x.h+$):(m.form.height=l.w,_())}}},visible:e=>!!e.row},{label:"背景颜色",name:"bc",value:{type:"color",required:!1,onChange:e=>l.bc=e}},{label:"横向位置",name:"justifyContent",value:{type:"radioButton",options:[{label:"居左",value:"s"},{label:"居中",value:"c"},{label:"居右",value:"e"}],labelKey:"label",valueKey:"value",required:!1,onChange:e=>l.justifyContent=e}},{label:"纵向位置",name:"alignItems",value:{type:"radioButton",options:[{label:"靠顶",value:"s"},{label:"居中",value:"c"},{label:"靠底",value:"e"}],labelKey:"label",valueKey:"value",required:!1,onChange:e=>l.alignItems=e}},{label:"文字内容",name:"text",value:{type:"text",required:!1,rows:3,onChange:e=>l.text=e}},{label:"文字颜色",name:"color",value:{type:"color",required:!1,onChange:e=>l.color=e}},{label:"文字大小",name:"fontSize",value:{type:"number",required:!1,min:10,max:1e3,onChange:e=>l.fontSize=e}},{label:"字体粗细",name:"fontWeight",value:{type:"number",required:!1,min:0,step:100,max:1e3,onChange:e=>l.fontWeight=e}},{label:"文字行高",name:"lineHeight",value:{type:"number",required:!1,min:0,max:1e3,onChange:e=>l.lineHeight=e}},{label:"文字间距",name:"letterSpacing",value:{type:"number",required:!1,min:0,max:100,onChange:e=>l.letterSpacing=e}},{label:"首行缩进",name:"textIndent",value:{type:"number",required:!1,min:0,max:10,onChange:e=>l.textIndent=e}},{label:"文字对齐",name:"textAlign",value:{type:"radioButton",options:[{label:"居左",value:"left"},{label:"居中",value:"center"},{label:"居右",value:"right"}],labelKey:"label",valueKey:"value",required:!1,onChange:e=>l.textAlign=e}},{label:"文字装饰",name:"textDecoration",value:{type:"checkboxButton",options:[{label:"斜体字",value:"italic"},{label:"下划线",value:"underline"},{label:"删除线",value:"line-through"},{label:"上划线",value:"overline"}],labelKey:"label",valueKey:"value",required:!1,onChange:e=>l.textDecoration=e}},{label:"设置图片",name:"image",value:{type:"image",required:!1,onChange:e=>l.image=e}},{label:"图片模式",name:"objectFit",value:{type:"radioButton",options:[{label:"拉伸填充",value:"full"},{label:"短边伸满",value:"contain"},{label:"长边伸满",value:"cover"}],labelKey:"label",valueKey:"value",required:!1,onChange:e=>l.objectFit=e}},{label:"设计表单",name:"forms",value:{required:!1,render:({v:e,$:f})=>Ft(zt("el-button"),{onClick:()=>b()},{default:()=>[e?"修改表单":"设计表单"]})}}]},b=o=>{nt.dialog2.show({title:"设计表单",width:1e3,component:()=>lt(()=>import("./CreateForm-d1294b25.js"),["./CreateForm-d1294b25.js","./index-75c887b9.js","./index-03d0ab2d.css"],import.meta.url),props:{forms:g.current.cell.forms,formOptions:g.current.cell.formOptions,callback:(l,e)=>{g.current.cell.forms=l,g.current.cell.formOptions=e}}})},_=()=>{m.formVisible=!1,ot(()=>{m.formVisible=!0})};return dt(g,o=>{o.current?m.oldCurrent!=o.current&&(m.oldCurrent=o.current,m.form.width=o.current.cell.w,m.form.height=o.current.cell.h,m.form.bc=o.current.cell.bc,m.form.justifyContent=o.current.cell.justifyContent,m.form.alignItems=o.current.cell.alignItems,m.form.text=o.current.cell.text,m.form.color=o.current.cell.color,m.form.fontSize=o.current.cell.fontSize,m.form.fontWeight=o.current.cell.fontWeight,m.form.lineHeight=o.current.cell.lineHeight,m.form.letterSpacing=o.current.cell.letterSpacing,m.form.textIndent=o.current.cell.textIndent,m.form.textAlign=o.current.cell.textAlign,m.form.textDecoration=o.current.cell.textDecoration,m.form.image=o.current.cell.image,m.form.objectFit=o.current.cell.objectFit,m.fields=D(o.current).filter(l=>!l.visible||l.visible(o.current)),_()):m.formVisible=!1},{deep:!0}),(o,l)=>{const e=Ae("FormItem"),f=Ae("el-form");return te(),We("div",{class:"_hf_400 _bo _of_y_auto",onMousedown:l[0]||(l[0]=Et((...d)=>o.utils.noop&&o.utils.noop(...d),["stop"]))},[ee(m).formVisible?(te(),Ke(f,{key:0,model:ee(m).form,"label-width":100},{default:Nt(()=>[(te(!0),We(Mt,null,It(ee(m).fields,(d,$)=>(te(),Ke(e,{key:$,label:d.label,prop:d.name,value:d.value,field:d,form:ee(m).form},null,8,["label","prop","value","field","form"]))),128))]),_:1},8,["model"])):Bt("",!0)],32)}}},Je=window.Vue.renderList,Ue=window.Vue.Fragment,ne=window.Vue.openBlock,le=window.Vue.createElementBlock,oe=window.Vue.normalizeStyle,R=window.Vue.createElementVNode,Ze=window.Vue.toDisplayString,Ge=window.Vue.withModifiers,Ht=window.Vue.resolveComponent,Tt=window.Vue.createVNode,qt=["onClick"],Ot=["onClick"],Qe=20,Rt={__name:"TreePanel",props:{parent:null,rows:null,level:{default:1},current:null,onSelectCell:null},setup(t){return(g,m)=>{const D=Ht("TreePanel",!0);return ne(!0),le(Ue,null,Je(t.rows,(b,_)=>(ne(),le("div",{key:_},[R("div",{class:"_h_20 _mt_20 _button _fx_r _por",onClick:Ge(o=>t.onSelectCell(o,{parent:t.parent,row:b,rows:t.rows,index:_}),["prevent","stop"])},[R("div",{style:oe(g._u(`_hf_${Qe*t.level} _bol_${b==t.current?"red":"d3d3d3"} _bob_${b==t.current?"red":"d3d3d3"}`))},null,4),R("div",{style:oe(g._u(`_fs_14_${b==t.current?"red":"gray"} _ml_10`))},Ze(b.name||"第"+_+"行"),5)],8,qt),(ne(!0),le(Ue,null,Je(b.cols,(o,l)=>(ne(),le("div",{key:l,class:"_mt_20"},[R("div",{class:"_h_20 _button _fx_r _por",onClick:Ge(e=>t.onSelectCell(e,{parent:b,col:o,cols:b.cols,index:l}),["prevent","stop"])},[R("div",{style:oe(g._u(`_hf_${Qe*(t.level+1)} _bol_${o==t.current?"red":"d3d3d3"} _bob_${o==t.current?"red":"d3d3d3"}`))},null,4),R("div",{style:oe(g._u(`_fs_14_${o==t.current?"red":"gray"} _ml_10`))},Ze(o.name||"第"+l+"列"),5)],8,Ot),Tt(D,{parent:o,rows:o.rows,level:t.level+2,current:t.current,onSelectCell:t.onSelectCell},null,8,["parent","rows","level","current","onSelectCell"])]))),128))]))),128)}}},Lt=window.Vue.renderList,Yt=window.Vue.Fragment,ve=window.Vue.openBlock,be=window.Vue.createElementBlock,$e=window.Vue.resolveComponent,j=window.Vue.createVNode,H=window.Vue.createElementVNode,Xt=window.Vue.createTextVNode,Pt=window.Vue.withCtx,Wt=window.Vue.normalizeStyle,At={class:"_hf_400 _bo _of_y_auto _of_x_hidden _ph_10"},Kt={class:"_hf_340"},Jt=H("div",{class:"_h_10"},null,-1),Ut={class:"_fx_r"},Zt={class:"_fx_1"},Gt=H("div",{class:"_h_10"},null,-1),Qt=H("div",{class:"_h_10"},null,-1),en=H("div",{class:"_h_10"},null,-1),tn={class:"_hf_40 _fx_ccc"},nn={__name:"DataPanel",props:{apis:null,panelData:null},setup(t){const g=t,m=(_,o)=>{_=V.cloneDeep(_),_.i=V.maxValue(g.apis,"i")+1,g.apis.splice(o+1,0,_)},D=_=>{g.apis.length>1&&g.apis.splice(_,1)},b=async _=>{var f;if(!_.name)return M("请填写数据名称");let o={};if(_.params&&(o=rt(_.params),o.error))return M(o.message);if(o.value&&!V.isPlainObject(o.value))return M("参数必须是对象");const l=await ce((f=_.api)==null?void 0:f.replace(/^\/?(api)?\/?/,"/"),o.value);if(!l.success)return M(l.message);let e=l.result;_.format&&(e=Y(_.format)({$:e,_:V,moment:X,utils:P})),g.panelData[_.name]=e,_.result=JSON.stringify(e)};return(_,o)=>{const l=$e("FormTextItem"),e=$e("el-button"),f=$e("FormCodeItem");return ve(),be("div",At,[(ve(!0),be(Yt,null,Lt(t.apis,(d,$)=>(ve(),be("div",{class:"_s_400_480 _fx_r _por _pv_10 _bob",key:d.i},[H("div",Kt,[j(l,{label:"名称",prop:"name",type:"text",form:d,placeholder:"填写数据名称",required:!1},null,8,["form"]),Jt,H("div",Ut,[H("div",Zt,[j(l,{label:"接口",prop:"api",type:"text",form:d,placeholder:"填写数据接口,如:list/member",required:!1},null,8,["form"])]),j(e,{plain:"",type:"primary",class:"_ml_4",onClick:x=>b(d)},{default:Pt(()=>[Xt("测试")]),_:2},1032,["onClick"])]),Gt,j(f,{label:"参数",prop:"params",form:d,placeholder:"填写json数据",required:!1,height:"120"},null,8,["form"]),Qt,j(f,{label:"修正",prop:"format",form:d,placeholder:"修正结果数据，如:$.x.y",required:!1,height:"120"},null,8,["form"]),en,j(f,{label:"结果",prop:"result",form:d,placeholder:"填写json数据",required:!1,height:"120"},null,8,["form"])]),H("div",tn,[j(e,{type:"primary",icon:_.icon.CopyDocument,circle:"",size:"small",onClick:x=>m(d,$)},null,8,["icon","onClick"]),j(e,{style:Wt(_._u("_ml_0 _mt_10")),disabled:t.apis.length<=1,type:"danger",icon:_.icon.Delete,circle:"",size:"small",onClick:x=>D($)},null,8,["style","disabled","icon","onClick"])])]))),128))])}}},v=window.Vue.unref,p=window.Vue.createVNode,T=window.Vue.resolveComponent,k=window.Vue.withCtx,et=window.Vue.withModifiers,B=window.Vue.createElementVNode,E=window.Vue.createTextVNode,I=window.Vue.openBlock,A=window.Vue.createBlock,K=window.Vue.createCommentVNode,ln=window.Vue.renderList,on=window.Vue.Fragment,L=window.Vue.createElementBlock,ye=window.Vue.normalizeStyle,tt=window.Vue.Teleport,rn={class:"_hf _fx_r"},sn={class:"_hf _fx_c _mh_4"},an={class:"_s_417_60_f0f0f0 _fx_ra _ph_20"},cn={key:0,class:"_hf_417 _bo _por _of_hidden"},un={key:0,class:"_full_pink80"},dn={key:1,class:"_full _fx_r"},mn=["onMousedown","onContextmenu"],fn={class:"_full _fx_r"},wn={class:"_hf_40 _fx_rc _cursor_move"},_n=B("span",null,null,-1),re=20,gn={__name:"index",props:{record:null,callback:null,showCancel:{type:Boolean,default:!0}},setup(t){var De,Se,Ie,Me,Ne;const g=W(),m=W(),D=W(!1),b=W({}),_=W({left:"-1000px",top:"-1000px"}),o=t;let l=(Se=(De=o.record)==null?void 0:De.rows)!=null&&Se.length?o.record.rows:[{w:375,h:300,bc:"#ff00ff",cols:[]}];const e=ae({listVisible:!0,movingItem:!1,rows:V.cloneDeep(l),selectedCell:null,apis:(Me=(Ie=o.record)==null?void 0:Ie.apis)!=null&&Me.length?o.record.apis:[{name:"fang",api:"/list/tb_member",format:"({$, _})=>_.get($, 'list.0')"}],panelData:{}}),f=async()=>{var i;for(const n of e.apis){let r={};if(n.params&&(r=rt(n.params),r.error))return M(r.message);if(r.value&&!V.isPlainObject(r.value))return M("参数必须是对象");const a=await ce((i=n.api)==null?void 0:i.replace(/^\/?(api)?\/?/,"/"),r.value);if(!a.success)return M(a.message);let c=a.result;n.format&&(c=Y(n.format)({$:c,_:V,moment:X,utils:P})),e.panelData[n.name]=c}};(Ne=e.apis)!=null&&Ne.length&&f();const d=()=>"#ffffff",$=async()=>{const i=e.apis.filter(n=>V.pick(n,"name","api","format"));o.callback&&o.callback({rows:e.rows,apis:i})},x=async()=>{o.callback&&o.callback()},h=(i,n)=>{if(D.value)return m.value.handleClose();b.value=n,_.value={left:i.pageX+"px",top:i.pageY+"px"},ot(()=>{m.value.handleOpen()})},S=i=>{D.value=i},Ce=({rows:i,cols:n,index:r},a)=>{nt.dialog2.show({title:a?"分割单元格为多列":"分割单元格为多行",width:400,component:()=>lt(()=>import("./SplitGrid-62cf1344.js"),["./SplitGrid-62cf1344.js","./index-75c887b9.js","./index-03d0ab2d.css"],import.meta.url),props:{isColumn:a,callback:c=>{let s=0;for(let u=1;u<=c.count;u++)s+=+(c[u]||1);if(a)if(i){const u=[],w=i[r],{w:N,h:y}=w;for(let C=1;C<=c.count;C++)u.push({w:c[C]/s*N,h:y,bc:d()});w.cols=u}else{const u=[],w=n[r],{w:N,h:y}=w;w.w=c[1]/s*N;for(let C=2;C<=c.count;C++)u.push({w:c[C]/s*N,h:y,bc:d()});n.splice(r+1,0,...u)}else if(n){const u=[],w=n[r],{w:N,h:y}=w;for(let C=1;C<=c.count;C++)u.push({h:c[C]/s*y,w:N,bc:d()});w.rows=u}else{const u=[],w=i[r],{w:N,h:y}=w;w.h=c[1]/s*y;for(let C=2;C<=c.count;C++)u.push({h:c[C]/s*y,w:N,bc:d()});i.splice(r+1,0,...u)}}}})},J=({parent:i,rows:n,cols:r,index:a},c)=>{if(n){if(c==="up"){i&&(n[a].h/=2);const s=V.cloneDeep(n[a]);s.bc=d(),n.splice(a,0,s)}else if(c==="down"){i&&(n[a].h/=2);const s=V.cloneDeep(n[a]);s.bc=d(),n.splice(a+1,0,s)}else if(c==="left"){const s=n[a],{w:u,h:w}=s;s.cols=[{w:u/2,h:w,bc:d()},{w:u/2,h:w,bc:s.bc}]}else if(c==="right"){const s=n[a],{w:u,h:w}=s;s.cols=[{w:u/2,h:w,bc:s.bc},{w:u/2,h:w,bc:d()}]}}else if(c==="left"){r[a].w/=2;const s=V.cloneDeep(r[a]);s.bc=d(),r.splice(a,0,s)}else if(c==="right"){r[a].w/=2;const s=V.cloneDeep(r[a]);s.bc=d(),r.splice(a+1,0,s)}else if(c==="up"){const s=r[a],{w:u,h:w}=s;s.rows=[{w:u,h:w/2,bc:d()},{w:u,h:w/2,bc:s.bc}]}else if(c==="down"){const s=r[a],{w:u,h:w}=s;s.rows=[{w:u,h:w/2,bc:s.bc},{w:u,h:w/2,bc:d()}]}},it=async({parent:i,rows:n,cols:r,index:a})=>{if(n)if(n.length===2){if(!await Be("该列只剩下两行，如果要删除这行需要同时删除这两行，确认要删除吗?"))return;i.rows=null}else n.splice(a,1);else if(r.length===2){if(!await Be("该行只剩下两列，如果要删除这列需要同时删除这两列，确认要删除吗?"))return;i.cols=null}else r.splice(a,1)},U=(i,n)=>{var r,a;if(n<re)return!1;if((r=i.cols)!=null&&r.length){for(const c of i.cols)if((a=c.rows)!=null&&a.length){let s=0;for(let w=1;w<c.rows.length;w++)s+=c.rows[w].h;if(n-s<re)return!1;const u=U(c.rows[0],n-s);if(!u)return u}}return!0},ue=(i,n)=>{var r,a;if(n<re)return!1;if((r=i.rows)!=null&&r.length){for(const c of i.rows)if((a=c.cols)!=null&&a.length){let s=0;for(let w=1;w<c.cols.length;w++)s+=c.cols[w].w;if(n-s<re)return!1;const u=ue(c.cols[0],n-s);if(!u)return u}}return!0},Z=(i,n)=>{var r,a;if(i.h=n,(r=i.cols)!=null&&r.length){for(const c of i.cols)if(c.h=n,(a=c.rows)!=null&&a.length){let s=0;for(let u=1;u<c.rows.length;u++)s+=c.rows[u].h;Z(c.rows[0],n-s)}}},de=(i,n)=>{var r,a;if(i.w=n,(r=i.rows)!=null&&r.length){for(const c of i.rows)if(c.w=n,(a=c.cols)!=null&&a.length){let s=0;for(let u=1;u<c.cols.length;u++)s+=c.cols[u].w;de(c.cols[0],n-s)}}},st=(i,{cols:n,index:r})=>{i.button==0&&(e.lastX=i.clientX,e.lastItems=V.cloneDeep(n),e.items=n,e.index=r,e.draggingH=!0)},at=(i,{parent:n,rows:r,index:a})=>{i.button==0&&(e.lastY=i.clientY,e.lastItems=V.cloneDeep(r),e.items=r,e.index=a,e.isOuter=!n,e.draggingV=!0)},ct=(i,{rows:n,index:r})=>{i.button==0&&(e.lastX=i.pageX,e.lastY=i.pageY,e.movingX=e.lastX-i.layerX,e.movingY=e.lastY-i.layerY,e.lastMovingX=e.movingX,e.lastMovingY=e.movingY,e.lastItems=V.cloneDeep(n),e.items=n,e.index=r,e.movingRow=n[r],e.movingItem=!0)},xe=i=>{if(e.draggingH){const n=i.clientX-e.lastX,r=e.lastItems[e.index].w+n,a=e.lastItems[e.index+1].w-n;ue(e.items[e.index],r)&&ue(e.items[e.index+1],a)&&(de(e.items[e.index],r),de(e.items[e.index+1],a));return}if(e.draggingV){const n=i.clientY-e.lastY;if(e.isOuter){const r=e.lastItems[e.index].h+n;if(U(e.items[e.index],r)){Z(e.items[e.index],r);for(let a=e.index+1;a<e.items.length;a++)e.items[a].y=e.lastItems[a].y+n}}else{const r=e.lastItems[e.index].h+n,a=e.lastItems[e.index+1].h-n;U(e.items[e.index],r)&&U(e.items[e.index+1],a)&&(Z(e.items[e.index],r),Z(e.items[e.index+1],a))}return}if(e.movingItem){const n=i.clientX-e.lastX,r=i.clientY-e.lastY;e.movingX=e.lastMovingX+n,e.movingY=e.lastMovingY+r;const a=g.value.childNodes;let c=0;const s=e.movingY+e.movingRow.h/2;for(const u of a)if(u.nodeType===Node.ELEMENT_NODE){const w=u.getBoundingClientRect();if(s>w.y&&s<w.y+w.height)break;c++}c<e.rows.length&&c!=e.index&&(e.rows.splice(e.index,1),e.index=c,e.rows.splice(c,0,e.movingRow))}},pe=()=>{e.draggingH=!1,e.draggingV=!1,e.movingItem=!1},ut=()=>{e.selectedCell&&(delete e.selectedCell.cell.selected,e.selectedCell=null)},ke=(i,{parent:n,row:r,rows:a,index:c,col:s,cols:u})=>{i.button==0&&(e.selectedCell&&delete e.selectedCell.cell.selected,e.selectedCell={cell:r||s,parent:n,row:r,rows:a,index:c,col:s,cols:u},e.selectedCell.cell.selected=!0)};return mt(()=>{document.addEventListener("mousemove",xe),document.addEventListener("mouseup",pe)}),ft(()=>{document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",pe)}),(i,n)=>{const r=T("el-tab-pane"),a=T("el-tabs"),c=T("el-button"),s=T("Icon"),u=T("el-dropdown-item"),w=T("el-dropdown-menu"),N=T("el-dropdown");return I(),L("div",{class:"_full _fx_rc",onMousedown:ut},[B("div",rn,[B("div",{class:"_hf_420 _bo _of_y_auto _p_10",onMousedown:n[0]||(n[0]=et((...y)=>i.utils.noop&&i.utils.noop(...y),["stop"]))},[p(a,null,{default:k(()=>[p(r,{label:"组件列表"},{default:k(()=>{var y;return[p(Rt,{rows:v(e).rows,current:(y=v(e).selectedCell)==null?void 0:y.cell,onSelectCell:ke},null,8,["rows","current"])]}),_:1}),p(r,{label:"数据获取"},{default:k(()=>[p(nn,{panelData:v(e).panelData,apis:v(e).apis},null,8,["panelData","apis"])]),_:1})]),_:1})],32),B("div",sn,[B("div",an,[t.showCancel?(I(),A(c,{key:0,type:"danger",plain:"",onClick:n[1]||(n[1]=y=>x()),class:"_w_100"},{default:k(()=>[E("取消")]),_:1})):K("",!0),p(c,{type:"primary",plain:"",onClick:n[2]||(n[2]=y=>$()),class:"_w_100"},{default:k(()=>[E("确定")]),_:1})]),v(e).listVisible?(I(),L("div",cn,[B("div",{class:"_full _of_y_auto",ref_key:"containerRef",ref:g},[(I(!0),L(on,null,ln(v(e).rows,(y,C)=>(I(),L("div",{key:C,style:ye(i._u(`_s_415_${y.h+1} _bob _por`))},[v(e).movingItem&&C==v(e).index?(I(),L("div",un)):(I(),L("div",dn,[B("div",{class:"_hf_40 _fx_rc _cursor_move",onMousedown:me=>ct(me,{rows:v(l),index:C}),onContextmenu:et(me=>h(me,{rows:v(e).rows,index:C,isOnlyCopy:!0}),["prevent","stop"])},[p(s,{icon:"icon-move",color:"#a0a0a0"})],40,mn),p(Ve,{panelData:v(e).panelData,row:y,rows:v(e).rows,index:C,startDragH:st,startDragV:at,showContextMenu:h,onSelectCell:ke},null,8,["panelData","row","rows","index"])]))],4))),128))],512)])):K("",!0)]),p(jt,{current:v(e).selectedCell},null,8,["current"])]),v(e).movingItem?(I(),A(tt,{key:0,to:"body"},[B("div",{style:ye(i._u(`_s_415_${v(e).movingRow.h+2}_white _bo _poa_t${v(e).movingY}_l${v(e).movingX} _zi_10000 _rotate_2`))},[B("div",fn,[B("div",wn,[p(s,{icon:"icon-move",color:"#a0a0a0"})]),p(Ve,{row:v(e).movingRow,startDragH:i.utils.noop,startDragV:i.utils.noop,onSelectCell:i.utils.noop},null,8,["row","startDragH","startDragV","onSelectCell"])])],4)])):K("",!0),(I(),A(tt,{to:"body"},[p(N,{ref_key:"contextmenuRef",ref:m,trigger:"contextmenu",class:"_poa _zi_1000",style:ye(v(_)),onVisibleChange:S},{dropdown:k(()=>[p(w,null,{default:k(()=>[v(b).isOnlyCopy?K("",!0):(I(),A(u,{key:0,onClick:n[3]||(n[3]=y=>Ce(v(b),!0))},{default:k(()=>[E("分解为多列")]),_:1})),v(b).isOnlyCopy?K("",!0):(I(),A(u,{key:1,onClick:n[4]||(n[4]=y=>Ce(v(b)))},{default:k(()=>[E("分解为多行")]),_:1})),p(u,{onClick:n[5]||(n[5]=y=>J(v(b),"up"))},{default:k(()=>[E("向上复制")]),_:1}),p(u,{onClick:n[6]||(n[6]=y=>J(v(b),"down"))},{default:k(()=>[E("向下复制")]),_:1}),p(u,{onClick:n[7]||(n[7]=y=>J(v(b),"left"))},{default:k(()=>[E("向左复制")]),_:1}),p(u,{onClick:n[8]||(n[8]=y=>J(v(b),"right"))},{default:k(()=>[E("向右复制")]),_:1}),p(u,{onClick:n[9]||(n[9]=y=>it(v(b)))},{default:k(()=>[E("删除")]),_:1})]),_:1})]),default:k(()=>[_n]),_:1},8,["style"])]))],32)}}};export{gn as default};
